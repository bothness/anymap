var Bt=Object.defineProperty;var bt=c=>{throw TypeError(c)};var Nt=(c,a,i)=>a in c?Bt(c,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[a]=i;var gt=(c,a,i)=>Nt(c,typeof a!="symbol"?a+"":a,i),ot=(c,a,i)=>a.has(c)||bt("Cannot "+i);var z=(c,a,i)=>(ot(c,a,"read from private field"),i?i.call(c):a.get(c)),I=(c,a,i)=>a.has(c)?bt("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(c):a.set(c,i),rt=(c,a,i,n)=>(ot(c,a,"write to private field"),n?n.call(c,i):a.set(c,i),i),_t=(c,a,i)=>(ot(c,a,"access private method"),i);import{a as C,t as j,c as Ut}from"../chunks/disclose-version.99O-hdS6.js";import{i as Ft}from"../chunks/legacy.DWlfCNZp.js";import{I as Jt,k as Kt,x as Rt,J as Vt,K as xt,L as jt,z as O,A as Et,q as t,M as b,B as _,D as $,C as g,N as it,y as Ht,O as k,P as wt}from"../chunks/runtime.D7Av2bsv.js";import{e as S,s as $t}from"../chunks/render.DAZ0GJAO.js";import{i as zt}from"../chunks/if.Daf_QZpO.js";import{s as X,I as F,S as Qt,C as te,p as ee,a as T,e as se,m as ct,t as J,h as ae}from"../chunks/Credit.eKnfq3yY.js";import{s as oe,a as kt}from"../chunks/props.rWO465ez.js";import{a as re}from"../chunks/entry.D4hh4QMb.js";import{b as nt}from"../chunks/control.B9pssHzG.js";var y,A,D,R,Mt;const V=class V{constructor(a){I(this,R);I(this,y,new WeakMap);I(this,A);I(this,D);rt(this,D,a)}observe(a,i){var n=z(this,y).get(a)||new Set;return n.add(i),z(this,y).set(a,n),_t(this,R,Mt).call(this).observe(a,z(this,D)),()=>{var w=z(this,y).get(a);w.delete(i),w.size===0&&(z(this,y).delete(a),z(this,A).unobserve(a))}}};y=new WeakMap,A=new WeakMap,D=new WeakMap,R=new WeakSet,Mt=function(){return z(this,A)??rt(this,A,new ResizeObserver(a=>{for(var i of a){V.entries.set(i.target,i);for(var n of z(this,y).get(i.target)||[])n(i)}}))},gt(V,"entries",new WeakMap);let lt=V;var ie=new lt({box:"border-box"});function yt(c,a,i){var n=ie.observe(c,()=>i(c[a]));Jt(()=>(Kt(()=>i(c[a])),n))}const ce=Math.PI/180;function ne(c,a,i){const n=K(c,a,i);return n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),n}function K(c,a,i){const n=Math.sin(a*ce),w=Math.pow(2,i);let h=w*(c/360+.5);const d=w*(.5-.25*Math.log((1+n)/(1-n))/Math.PI);return h=h%w,h<0&&(h=h+w),[h,d,i]}var le=j('<button tabindex="-1" class="tile svelte-1s20svq"><img class="tile-img svelte-1s20svq" alt=""></button>'),fe=j('<div tabindex="0" class="grid svelte-1s20svq"></div>'),ve=j('<div class="grid svelte-1s20svq"> <!> tiles.</div>'),ue=j('<main class="svelte-1s20svq"><div class="flex-row svelte-1s20svq"><nav class="flex-left svelte-1s20svq">&lt; <a class="svelte-1s20svq">Any Map Puzzle</a></nav> <div class="flex-right svelte-1s20svq"><a class="icon-button zoom-button svelte-1s20svq" title="Zoom in"><!></a> <a class="icon-button zoom-button svelte-1s20svq" title="Zoom out"><!></a></div></div> <div class="flex-row svelte-1s20svq"><h1 class="flex-left svelte-1s20svq"> </h1> <div class="floating-icons flex-right svelte-1s20svq"><button class="icon-button svelte-1s20svq"><!>Shuffle</button> <button class="icon-button svelte-1s20svq"><!>Share</button> <!></div></div>  <!> <!></main>');function ze(c,a){Rt(a,!1);const i=oe(),n=()=>kt(Xt,"$config",i),w=()=>kt(ee,"$page",i),h=k(),d=k(),Xt=Vt("config"),u=n().gridSize,E=7-u;let p=k(),v,M=k(),G=k(),W=k(!1),H=k(!1),L=k(!1),B=k(!1);function Yt(e){const r=Math.floor(u/2),o=[e[0]-r,e[1]-r,e[2]].map(s=>s<0?0:s),l=[];for(let s=0;s<u;s++){const f=[];for(let m=0;m<u;m++){const x={i:m*u+s,x:s,y:m,cX:s,cY:m,xyz:[o[0]+s,o[1]+m,o[2]],blank:!1};f.push(x)}l.push(f)}return v=l[u-1][u-1],v.blank=!0,l}async function qt(){t(p).flat().every(e=>e.x===e.cX&&e.y===e.cY)&&(b(L,!0),await new Promise(e=>setTimeout(e,200)),await window.confetti({particleCount:500,spread:360,scalar:1.5}))}function ft(e,r){const o={cX:e.cX,cY:e.cY};e.cX=r.cX,e.cY=r.cY,r.cX=o.cX,r.cY=o.cY,wt(p,t(p)[e.cX][e.cY]=e),wt(p,t(p)[r.cX][r.cY]=r)}function vt(e){if(t(L))return;const r=[];if(e.cX===v.cX){const o=e.cY-v.cY,l=Math.sign(o);for(let s=1;s<=Math.abs(o);s++)r.push(t(p)[v.cX][v.cY+s*l])}else if(e.cY===v.cY){const o=e.cX-v.cX,l=Math.sign(o);for(let s=1;s<=Math.abs(o);s++)r.push(t(p)[v.cX+s*l][v.cY])}for(const o of r)ft(o,v);qt()}function Tt(e){var o,l,s,f,m,P,x,ht;const r=e.code;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r)){e.preventDefault();let q;switch(r){case"ArrowUp":q=(l=(o=t(p))==null?void 0:o[v.cX])==null?void 0:l[v.cY+1];break;case"ArrowDown":q=(f=(s=t(p))==null?void 0:s[v.cX])==null?void 0:f[v.cY-1];break;case"ArrowLeft":q=(P=(m=t(p))==null?void 0:m[v.cX+1])==null?void 0:P[v.cY];break;case"ArrowRight":q=(ht=(x=t(p))==null?void 0:x[v.cX-1])==null?void 0:ht[v.cY];break}q&&vt(q)}}function At(e){let r;for(let o=0;o<e+e%2;o++){const l=[[-1,0],[1,0],[0,-1],[0,1]].map(s=>{var f,m;return(m=(f=t(p))==null?void 0:f[v.cX+s[0]])==null?void 0:m[v.cY+s[1]]}).filter(s=>s&&s.i!==(r==null?void 0:r.i));r=l[Math.floor(Math.random()*l.length)],ft(v,r)}}async function ut(){b(L,!1);const e=K(...n().place.bbox.slice(0,2),0),r=K(...n().place.bbox.slice(2),0);let o=0,l=[r[0]-e[0],e[1]-r[1]];for(;o<t(d).maxZoom&&l[0]<u&&l[1]<u;)l=l.map(f=>f*2),o++;t(h)&&(o=(()=>{let f=o+t(h);return f<2?2:f>t(d).maxZoom?t(d).maxZoom:f})()),b(M,o);const s=u%2===1?ne(...n().place.centroid,o):K(...n().place.centroid,o).map(f=>Math.round(f));if(b(p,Yt(s)),At(Math.pow(u,3)),!t(W))try{(await fetch(t(d).url(...t(p)[0][0].xyz))).status===200?b(W,!0):b(H,!0)}catch{b(H,!0)}}re(()=>{b(W,!1),ut()}),xt(()=>n(),()=>{b(h,n().zoomOffset)}),xt(()=>n(),()=>{b(d,ct.find(e=>e.id===n().mapTiles)||ct[0])}),jt(),Ft();var Q=ue(),tt=_(Q),et=_(tt),Zt=$(_(et));X(Zt,"href",`${nt??""}/`),g(et);var dt=$(et,2),Y=_(dt),Pt=_(Y);F(Pt,{type:"zoomin"}),g(Y);var Z=$(Y,2),It=_(Z);F(It,{type:"zoomout"}),g(Z),g(dt),g(tt);var st=$(tt,2),at=_(st),Ct=_(at,!0);g(at);var pt=$(at,2),N=_(pt),Ot=_(N);F(Ot,{type:"shuffle",margin:!0}),it(),g(N);var U=$(N,2),St=_(U);F(St,{type:"share",margin:!0}),it(),g(U);var Dt=$(U,2);Qt(Dt,{get message(){return`Try this ${n().place.name??""} map puzzle %23AnyMapPuzzle`},get url(){return w().url.href},get open(){return t(B)},set open(e){b(B,e)},$$legacy:!0}),g(pt),g(st);var mt=$(st,2);{var Gt=e=>{var r=fe();T(r,"margin-right",`-${E??""}px`),se(r,5,()=>t(p).flat().sort((o,l)=>o.i-l.i),o=>o.i,(o,l)=>{var s=le();T(s,"width",`calc(${100/u}% - ${E??""}px)`),T(s,"height",`calc(${100/u}% - ${E??""}px)`);var f=_(s);O(()=>X(f,"src",t(d).url(...t(l).xyz))),g(s),O(()=>{J(s,"blank",t(l).blank&&!t(L)),J(s,"fade-in",t(l).blank),T(s,"left",`${100*(t(l).cX/u)}%`),T(s,"top",`${100*(t(l).cY/u)}%`)}),S("click",s,()=>vt(t(l))),C(o,s)}),g(r),O(()=>T(r,"height",`${(t(G)||100)??""}px`)),yt(r,"clientWidth",o=>b(G,o)),S("focus",r,o=>o.target.scrollIntoView()),S("keydown",r,Tt),C(e,r)},Wt=e=>{var r=Ut(),o=Ht(r);{var l=s=>{var f=ve(),m=_(f),P=$(m);ae(P,()=>ct.filter(x=>x.id!==t(d).id).map(x=>`<a href="${w().url.href.replace(t(d).id,x.id)}">${x.label}</a>`).join(" or ")),it(),g(f),O(()=>{X(f,"style",`height: ${(t(G)||100)??""}px; background: #ddd; padding: 12px;`),$t(m,`${t(d).label??""}
			map tiles not available for this area. Try zooming out or using `)}),yt(f,"clientWidth",x=>b(G,x)),C(s,f)};zt(o,s=>{t(H)&&s(l)},!0)}C(e,r)};zt(mt,e=>{t(W)?e(Gt):e(Wt,!1)})}var Lt=$(mt,2);te(Lt,{get attribution(){return t(d).attribution}}),g(Q),O(()=>{X(Y,"tabindex",t(M)>=t(d).maxZoom?"-1":null),X(Y,"href",`${nt??""}/${n().place.code??""}?maptiles=${t(d).id??""}&gridsize=${u??""}${(t(h)+1?`&zoom=${t(h)+1}`:"")??""}`),J(Y,"disabled",t(M)>=t(d).maxZoom),X(Z,"tabindex",u<5&&t(M)<3||t(M)<4?"-1":null),X(Z,"href",`${nt??""}/${n().place.code??""}?maptiles=${t(d).id??""}&gridsize=${u??""}${(t(h)-1?`&zoom=${t(h)-1}`:"")??""}`),J(Z,"disabled",u<5&&t(M)<3||t(M)<4),$t(Ct,n().place.name)}),S("click",N,ut),S("click",U,()=>b(B,!t(B))),C(c,Q),Et()}export{ze as component};
