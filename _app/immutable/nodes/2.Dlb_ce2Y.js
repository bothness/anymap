import{a as T,t as C}from"../chunks/disclose-version.99O-hdS6.js";import{i as ce}from"../chunks/legacy.DWlfCNZp.js";import{I as X,k as he,x as ue,y as ye,z as y,A as ve,B as d,C as u,D as g,J as we,K as J,L as xe,q as i,M as h,N as Se,O as V,ab as te,aB as ae}from"../chunks/runtime.D7Av2bsv.js";import{l as ze,s as Q,e as re}from"../chunks/render.DAZ0GJAO.js";import{i as pe}from"../chunks/if.Daf_QZpO.js";import{s as W,a as ke,I as Te,S as Ce,e as le,C as qe,p as Oe,i as se,m as U,d as G}from"../chunks/Credit.BFCy6D6M.js";import{i as De,p as b,s as je,a as ie}from"../chunks/props.rWO465ez.js";import{b as Ee}from"../chunks/control.DXsSTagE.js";import{g as Le}from"../chunks/entry.CLVnAHwD.js";import{c as Me}from"../chunks/index-client.DKpeL2NU.js";function Pe(e,t,s){X(()=>{var l=he(()=>t(e,s==null?void 0:s())||{});if(l!=null&&l.destroy)return()=>l.destroy()})}function de(e,t,s){if(e.multiple)return Ie(e,t);for(var l of e.options){var n=L(l);if(De(n,t)){l.selected=!0;return}}(!s||t!==void 0)&&(e.selectedIndex=-1)}function Ae(e,t){X(()=>{var s=new MutationObserver(()=>{var l=e.__value;de(e,l)});return s.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{s.disconnect()}})}function ne(e,t,s=t){var l=!0;ze(e,"change",n=>{var v=n?"[selected]":":checked",p;if(e.multiple)p=[].map.call(e.querySelectorAll(v),L);else{var o=e.querySelector(v)??e.querySelector("option:not([disabled])");p=o&&L(o)}s(p)}),X(()=>{var n=t();if(de(e,n,l),l&&n===void 0){var v=e.querySelector(":checked");v!==null&&(n=L(v),s(n))}e.__value=n,l=!1}),Ae(e)}function Ie(e,t){for(var s of e.options)s.selected=~t.indexOf(L(s))}function L(e){return"__value"in e?e.__value:e.value}function Ke(e){return function(...t){var s=t[0];return s.preventDefault(),e==null?void 0:e.apply(this,t)}}function Fe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var H,oe;function Ve(){if(oe)return H;oe=1;function e(t,s){if(typeof t!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof t}\`.`);let l,n=0;return function(...p){clearTimeout(l);const o=Date.now(),q=o-n,f=s-q;f<=0?(n=o,t.apply(this,p)):l=setTimeout(()=>{n=Date.now(),t.apply(this,p)},f)}}return H=e,H}var Be=Ve();const $e=Fe(Be);var Ne=C("<label> </label>"),Re=C('<!> <div class="autocomplete-container svelte-w4406e"></div>',1);function Je(e,t){ue(t,!1);let s=b(t,"value",12,""),l=b(t,"options",24,()=>[]),n=b(t,"id",8,"autocomplete"),v=b(t,"label",8,"Select a place"),p=b(t,"hideLabel",8,!1),o=b(t,"mode",8,"search"),q=b(t,"placeholder",24,()=>o()==="search"?"Type any place name":"Select one"),f=b(t,"labelKey",8,"name"),M=b(t,"groupKey",8,"group"),B=b(t,"suggest",8,(r,_)=>{const x=l().filter(E=>E[f()].match(new RegExp(`\\b${r.replace(/[^\w\s]/gi,"")}`,"i")));_(x)});const O=Me();function D(r){return(r==null?void 0:r[f()])||r||""}function P(r){return r!=null&&r[f()]?M()?`${r[f()]} <span class="muted-text">${r[M()]}</span>`:r[f()]:r}function z(r){r&&(s(r),O("change",r))}function j(r){window.accessibleAutocomplete({element:r,id:n(),defaultValue:s(),displayMenu:"overlay",source:B(),autoselect:o()==="search",onConfirm:z,placeholder:q(),showAllValues:o()==="default",minLength:o()==="search"?3:0,templates:{inputValue:D,suggestion:P}})}ce();var A=Re(),w=ye(A);{var I=r=>{var _=Ne(),x=d(_,!0);u(_),y(()=>{W(_,"for",n()),ke(_,"display",p()?"none":null),Q(x,v())}),T(r,_)};pe(w,r=>{v()&&r(I)})}var K=g(w,2);Pe(K,r=>j==null?void 0:j(r)),y(()=>W(K,"id",`${n()??""}-container`)),T(e,A),ve()}var Ue=C("<option> </option>"),Ge=C("<option> </option>"),He=C('<span class="credit">First select a place to start the puzzle</span>'),Qe=C('<main><div class="flex-row"><h1 class="flex-left">Any Map Puzzle</h1> <div class="floating-icons flex-right"><button class="icon-button svelte-wey0ek"><!>Share</button> <!></div></div> <form><!> <div class="columns svelte-wey0ek"><div><label>Select map tiles<br> <select class="svelte-wey0ek"></select></label> <label>Select difficulty<br> <select class="svelte-wey0ek"></select></label> <p><button type="submit" class="button svelte-wey0ek">Start puzzle</button> <!></p></div> <div class="tile svelte-wey0ek"><img class="tile-img svelte-wey0ek" alt=""></div></div></form> <!></main>');function it(e,t){ue(t,!1);const s=je(),l=()=>ie(q,"$config",s),n=()=>ie(Oe,"$page",s),v=V(),p=V(),o=V(),q=we("config");let f=V(!1);async function M(a,c){if(a&&a.length<3)return c([]);const m=`https://nominatim.openstreetmap.org/search?q=${a}&format=geojson`,be=(await(await fetch(m)).json()).features.map(S=>({code:S.properties.osm_type[0].toUpperCase()+S.properties.osm_id,name:S.properties.name,group:S.properties.display_name.slice(S.properties.name.length+2).replace(/israel$/i,"Palestine"),bbox:S.bbox,centroid:S.geometry.coordinates}));c(be)}function B(a){h(v,a.detail.code)}J(()=>l(),()=>{var a,c;h(v,(c=(a=l())==null?void 0:a.place)==null?void 0:c.code)}),J(()=>l(),()=>{h(p,G.find(a=>a.gridSize===l().gridSize)||G[1])}),J(()=>l(),()=>{h(o,U.find(a=>a.id===l().mapTiles)||U[0])}),xe(),ce();var O=Qe(),D=d(O),P=g(d(D),2),z=d(P),j=d(z);Te(j,{type:"share",margin:!0}),Se(),u(z);var A=g(z,2);Ce(A,{message:"Play map puzzles of any place %23AnyMapPuzzle",get url(){return n().url.href},get open(){return i(f)},set open(a){h(f,a)},$$legacy:!0}),u(P),u(D);var w=g(D,2),I=d(w),K=te(()=>{var a;return((a=l().place)==null?void 0:a.name)||""}),r=te(()=>$e(M,1e3));Je(I,{get value(){return i(K)},get suggest(){return i(r)},$$events:{change:B}});var _=g(I,2),x=d(_),E=d(x),$=g(d(E),3);y(()=>{i(o),ae(()=>{})}),le($,5,()=>U,se,(a,c)=>{var m=Ue(),k={},F=d(m,!0);u(m),y(()=>{k!==(k=i(c))&&(m.value=(m.__value=i(c))==null?"":i(c)),Q(F,i(c).label)}),T(a,m)}),u($),u(E);var N=g(E,2),R=g(d(N),3);y(()=>{i(p),ae(()=>{})}),le(R,5,()=>G,se,(a,c)=>{var m=Ge(),k={},F=d(m,!0);u(m),y(()=>{k!==(k=i(c))&&(m.value=(m.__value=i(c))==null?"":i(c)),Q(F,i(c).label)}),T(a,m)}),u(R),u(N);var Y=g(N,2),Z=d(Y),fe=g(Z,2);{var me=a=>{var c=He();T(a,c)};pe(fe,a=>{i(v)||a(me)})}u(Y),u(x);var ee=g(x,2),ge=d(ee);y(()=>W(ge,"src",i(o).url(19302,24631,16))),u(ee),u(_),u(w);var _e=g(w,2);qe(_e,{get attribution(){return i(o).attribution}}),u(O),y(()=>Z.disabled=!i(v)),re("click",z,()=>h(f,!i(f))),ne($,()=>i(o),a=>h(o,a)),ne(R,()=>i(p),a=>h(p,a)),re("submit",w,Ke(()=>Le(`${Ee}/${i(v)}?maptiles=${i(o).id}&gridsize=${i(p).gridSize}`))),T(e,O),ve()}export{it as component};
