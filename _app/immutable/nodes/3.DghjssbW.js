var Pt=Object.defineProperty;var lt=i=>{throw TypeError(i)};var Ct=(i,t,o)=>t in i?Pt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[t]=o;var ft=(i,t,o)=>Ct(i,typeof t!="symbol"?t+"":t,o),Z=(i,t,o)=>t.has(i)||lt("Cannot "+o);var x=(i,t,o)=>(Z(i,t,"read from private field"),o?o.call(i):t.get(i)),A=(i,t,o)=>t.has(i)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,o),j=(i,t,o,c)=>(Z(i,t,"write to private field"),c?c.call(i,o):t.set(i,o),o),dt=(i,t,o)=>(Z(i,t,"access private method"),o);import{a as I,t as F,c as St}from"../chunks/disclose-version.CBFeP9qm.js";import{i as Dt}from"../chunks/legacy.CeR6iruq.js";import{I as Gt,k as Wt,x as Lt,J as Bt,z as P,A as Ot,q as l,K as w,B as _,D as k,C as m,L as E,y as Ut,M as Y,N as ut}from"../chunks/runtime.DTQ_9slk.js";import{e as C,s as vt}from"../chunks/render.D9G3lN37.js";import{i as pt}from"../chunks/if.BUlbJtog.js";import{m as H,s as Q,I as ht,S as qt,C as Ft,p as Jt,a as $,e as Kt,t as bt,h as Nt}from"../chunks/Credit.paALa4g2.js";import{s as Rt,a as mt}from"../chunks/props.BkfbzHDM.js";import{o as Vt}from"../chunks/index-client.Zs5LPVau.js";import{b as Zt}from"../chunks/control.cx0Pu6wL.js";var M,y,S,U,xt;const q=class q{constructor(t){A(this,U);A(this,M,new WeakMap);A(this,y);A(this,S);j(this,S,t)}observe(t,o){var c=x(this,M).get(t)||new Set;return c.add(o),x(this,M).set(t,c),dt(this,U,xt).call(this).observe(t,x(this,S)),()=>{var b=x(this,M).get(t);b.delete(o),b.size===0&&(x(this,M).delete(t),x(this,y).unobserve(t))}}};M=new WeakMap,y=new WeakMap,S=new WeakMap,U=new WeakSet,xt=function(){return x(this,y)??j(this,y,new ResizeObserver(t=>{for(var o of t){q.entries.set(o.target,o);for(var c of x(this,M).get(o.target)||[])c(o)}}))},ft(q,"entries",new WeakMap);let tt=q;var jt=new tt({box:"border-box"});function gt(i,t,o){var c=jt.observe(i,()=>o(i[t]));Gt(()=>(Wt(()=>o(i[t])),c))}const Et=Math.PI/180;function Ht(i,t,o){const c=O(i,t,o);return c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c}function O(i,t,o){const c=Math.sin(t*Et),b=Math.pow(2,o);let z=b*(i/360+.5);const g=b*(.5-.25*Math.log((1+c)/(1-c))/Math.PI);return z=z%b,z<0&&(z=z+b),[z,g,o]}var Qt=F('<button tabindex="-1" class="tile svelte-1iz63xd"><img class="tile-img svelte-1iz63xd" alt=""></button>'),te=F('<div tabindex="0" class="grid svelte-1iz63xd"></div>'),ee=F('<div class="grid svelte-1iz63xd"> <!> tiles.</div>'),ae=F('<main class="svelte-1iz63xd"><nav class="svelte-1iz63xd">&lt; <a class="svelte-1iz63xd">Any Map Puzzle</a></nav> <div class="title-block svelte-1iz63xd"><h1 class="title svelte-1iz63xd"> </h1> <div class="floating-icons svelte-1iz63xd"><button class="icon-button svelte-1iz63xd"><!>Shuffle</button> <button class="icon-button svelte-1iz63xd"><!>Share</button> <!></div></div>  <!> <!></main>');function ve(i,t){Lt(t,!1);const o=Rt(),c=()=>mt(z,"$config",o),b=()=>mt(Jt,"$page",o),z=Bt("config"),g=H.find(e=>e.id===c().mapTiles)||H[0],v=c().gridSize,J=7-v;let p=Y(),f,D=Y(),et=Y(!1),at=Y(!1),G=Y(!1),W=Y(!1);function wt(e){const s=Math.floor(v/2),r=[e[0]-s,e[1]-s,e[2]],n=[];for(let a=0;a<v;a++){const u=[];for(let d=0;d<v;d++){const h={i:d*v+a,x:a,y:d,cX:a,cY:d,xyz:[r[0]+a,r[1]+d,r[2]],blank:!1};u.push(h)}n.push(u)}return f=n[v-1][v-1],f.blank=!0,n}async function _t(){l(p).flat().every(e=>e.x===e.cX&&e.y===e.cY)&&(w(G,!0),await new Promise(e=>setTimeout(e,200)),await window.confetti({particleCount:500,spread:360,scalar:1.5}))}function st(e,s){const r={cX:e.cX,cY:e.cY};e.cX=s.cX,e.cY=s.cY,s.cX=r.cX,s.cY=r.cY,ut(p,l(p)[e.cX][e.cY]=e),ut(p,l(p)[s.cX][s.cY]=s)}function rt(e){if(l(G))return;const s=[];if(e.cX===f.cX){const r=e.cY-f.cY,n=Math.sign(r);for(let a=1;a<=Math.abs(r);a++)s.push(l(p)[f.cX][f.cY+a*n])}else if(e.cY===f.cY){const r=e.cX-f.cX,n=Math.sign(r);for(let a=1;a<=Math.abs(r);a++)s.push(l(p)[f.cX+a*n][f.cY])}for(const r of s)st(r,f);_t()}function zt(e){var r,n,a,u,d,T,h,ct;const s=e.code;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s)){e.preventDefault();let X;switch(s){case"ArrowUp":X=(n=(r=l(p))==null?void 0:r[f.cX])==null?void 0:n[f.cY+1];break;case"ArrowDown":X=(u=(a=l(p))==null?void 0:a[f.cX])==null?void 0:u[f.cY-1];break;case"ArrowLeft":X=(T=(d=l(p))==null?void 0:d[f.cX+1])==null?void 0:T[f.cY];break;case"ArrowRight":X=(ct=(h=l(p))==null?void 0:h[f.cX-1])==null?void 0:ct[f.cY];break}X&&rt(X)}}function kt(e){let s;for(let r=0;r<e;r++){const n=[[-1,0],[1,0],[0,-1],[0,1]].map(a=>{var u,d;return(d=(u=l(p))==null?void 0:u[f.cX+a[0]])==null?void 0:d[f.cY+a[1]]}).filter(a=>a&&a.i!==(s==null?void 0:s.i));s=n[Math.floor(Math.random()*n.length)],st(f,s)}}async function ot(){w(G,!1);const e=O(...c().place.bbox.slice(0,2),0),s=O(...c().place.bbox.slice(2),0);let r=0,n=[s[0]-e[0],e[1]-s[1]];for(;r<g.maxZoom&&n[0]<v&&n[1]<v;)n=n.map(d=>d*2),r++;const a=v%2===1?Ht(...c().place.centroid,r):O(...c().place.centroid,r).map(d=>Math.round(d));w(p,wt(a)),(await fetch(g.url(...l(p)[0][0].xyz))).status===200?(kt(v*v*4),w(et,!0)):w(at,!0)}Vt(ot),Dt();var K=ae(),N=_(K),Mt=k(_(N));Q(Mt,"href",`${Zt??""}/`),m(N);var R=k(N,2),V=_(R),Xt=_(V,!0);m(V);var it=k(V,2),L=_(it),Yt=_(L);ht(Yt,{type:"shuffle",margin:!0}),E(),m(L);var B=k(L,2),$t=_(B);ht($t,{type:"share",margin:!0}),E(),m(B);var yt=k(B,2);qt(yt,{get message(){return`Try this ${c().place.name??""} map puzzle %23AnyMapPuzzle`},get url(){return b().url.href},get open(){return l(W)},set open(e){w(W,e)},$$legacy:!0}),m(it),m(R);var nt=k(R,2);{var Tt=e=>{var s=te();$(s,"margin-right",`-${J??""}px`),Kt(s,5,()=>l(p).flat().sort((r,n)=>r.i-n.i),r=>r.i,(r,n)=>{var a=Qt();$(a,"width",`calc(${100/v}% - ${J??""}px)`),$(a,"height",`calc(${100/v}% - ${J??""}px)`);var u=_(a);P(()=>Q(u,"src",g.url(...l(n).xyz))),m(a),P(()=>{bt(a,"blank",l(n).blank&&!l(G)),bt(a,"fade-in",l(n).blank),$(a,"left",`${100*(l(n).cX/v)}%`),$(a,"top",`${100*(l(n).cY/v)}%`)}),C("click",a,()=>rt(l(n))),I(r,a)}),m(s),P(()=>$(s,"height",`${(l(D)||100)??""}px`)),gt(s,"clientWidth",r=>w(D,r)),C("focus",s,r=>r.target.scrollIntoView()),C("keydown",s,zt),I(e,s)},At=e=>{var s=St(),r=Ut(s);{var n=a=>{var u=ee(),d=_(u),T=k(d);Nt(T,()=>H.filter(h=>h.id!==g.id).map(h=>`<a data-sveltekit-reload="" href="${b().url.href.replace(g.id,h.id)}">${h.label}</a>`).join(" or ")),E(),m(u),P(()=>{Q(u,"style",`height: ${(l(D)||100)??""}px; background: #ddd; padding: 12px;`),vt(d,`${g.label??""}
			map tiles not available for this area. Try using `)}),gt(u,"clientWidth",h=>w(D,h)),I(a,u)};pt(r,a=>{l(at)&&a(n)},!0)}I(e,s)};pt(nt,e=>{l(et)?e(Tt):e(At,!1)})}var It=k(nt,2);Ft(It,{get attribution(){return g.attribution}}),m(K),P(()=>vt(Xt,c().place.name)),C("click",L,ot),C("click",B,()=>w(W,!l(W))),I(i,K),Ot()}export{ve as component};
