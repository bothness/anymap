var Pt=Object.defineProperty;var lt=i=>{throw TypeError(i)};var Ct=(i,t,o)=>t in i?Pt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[t]=o;var ft=(i,t,o)=>Ct(i,typeof t!="symbol"?t+"":t,o),E=(i,t,o)=>t.has(i)||lt("Cannot "+o);var w=(i,t,o)=>(E(i,t,"read from private field"),o?o.call(i):t.get(i)),A=(i,t,o)=>t.has(i)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,o),H=(i,t,o,n)=>(E(i,t,"write to private field"),n?n.call(i,o):t.set(i,o),o),dt=(i,t,o)=>(E(i,t,"access private method"),o);import{a as I,t as F,c as St}from"../chunks/disclose-version.CBFeP9qm.js";import{i as Dt}from"../chunks/legacy.CeR6iruq.js";import{I as Gt,k as Wt,x as Lt,J as Bt,z as P,A as Ot,q as l,K as m,B as _,D as k,C as g,L as Q,y as Ut,M as Y,N as ut}from"../chunks/runtime.DTQ_9slk.js";import{e as C,s as vt}from"../chunks/render.D9G3lN37.js";import{i as pt}from"../chunks/if.BUlbJtog.js";import{m as tt,s as et,I as ht,S as qt,C as Ft,p as Jt,a as y,e as Kt,t as bt,h as Nt}from"../chunks/Credit.D2az4Sff.js";import{s as Rt,a as mt}from"../chunks/props.BkfbzHDM.js";import{o as Vt}from"../chunks/index-client.Zs5LPVau.js";import{b as Zt}from"../chunks/control.DD-npqhx.js";var M,$,S,U,xt;const q=class q{constructor(t){A(this,U);A(this,M,new WeakMap);A(this,$);A(this,S);H(this,S,t)}observe(t,o){var n=w(this,M).get(t)||new Set;return n.add(o),w(this,M).set(t,n),dt(this,U,xt).call(this).observe(t,w(this,S)),()=>{var b=w(this,M).get(t);b.delete(o),b.size===0&&(w(this,M).delete(t),w(this,$).unobserve(t))}}};M=new WeakMap,$=new WeakMap,S=new WeakMap,U=new WeakSet,xt=function(){return w(this,$)??H(this,$,new ResizeObserver(t=>{for(var o of t){q.entries.set(o.target,o);for(var n of w(this,M).get(o.target)||[])n(o)}}))},ft(q,"entries",new WeakMap);let at=q;var jt=new at({box:"border-box"});function gt(i,t,o){var n=jt.observe(i,()=>o(i[t]));Gt(()=>(Wt(()=>o(i[t])),n))}const Et=Math.PI/180;function Ht(i,t,o){const n=O(i,t,o);return n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),n}function O(i,t,o){const n=Math.sin(t*Et),b=Math.pow(2,o);let z=b*(i/360+.5);const x=b*(.5-.25*Math.log((1+n)/(1-n))/Math.PI);return z=z%b,z<0&&(z=z+b),[z,x,o]}var Qt=F('<button tabindex="-1" class="tile svelte-1iz63xd"><img class="tile-img svelte-1iz63xd" alt=""></button>'),te=F('<div tabindex="0" class="grid svelte-1iz63xd"></div>'),ee=F('<div class="grid svelte-1iz63xd"> <!> tiles.</div>'),ae=F('<main class="svelte-1iz63xd"><nav class="svelte-1iz63xd">&lt; <a class="svelte-1iz63xd">Any Map Puzzle</a></nav> <div class="title-block svelte-1iz63xd"><h1 class="title svelte-1iz63xd"> </h1> <div class="floating-icons svelte-1iz63xd"><button class="icon-button svelte-1iz63xd"><!>Shuffle</button> <button class="icon-button svelte-1iz63xd"><!>Share</button> <!></div></div>  <!> <!></main>');function ve(i,t){Lt(t,!1);const o=Rt(),n=()=>mt(z,"$config",o),b=()=>mt(Jt,"$page",o),z=Bt("config"),x=tt.find(e=>e.id===n().mapTiles)||tt[0],u=n().gridSize,J=7-u;let v=Y(),f,D=Y(),K=Y(!1),N=Y(!1),G=Y(!1),W=Y(!1);function wt(e){const s=Math.floor(u/2),r=[e[0]-s,e[1]-s,e[2]],c=[];for(let a=0;a<u;a++){const d=[];for(let p=0;p<u;p++){const h={i:p*u+a,x:a,y:p,cX:a,cY:p,xyz:[r[0]+a,r[1]+p,r[2]],blank:!1};d.push(h)}c.push(d)}return f=c[u-1][u-1],f.blank=!0,c}async function _t(){l(v).flat().every(e=>e.x===e.cX&&e.y===e.cY)&&(m(G,!0),await new Promise(e=>setTimeout(e,200)),await window.confetti({particleCount:500,spread:360,scalar:1.5}))}function st(e,s){const r={cX:e.cX,cY:e.cY};e.cX=s.cX,e.cY=s.cY,s.cX=r.cX,s.cY=r.cY,ut(v,l(v)[e.cX][e.cY]=e),ut(v,l(v)[s.cX][s.cY]=s)}function rt(e){if(l(G))return;const s=[];if(e.cX===f.cX){const r=e.cY-f.cY,c=Math.sign(r);for(let a=1;a<=Math.abs(r);a++)s.push(l(v)[f.cX][f.cY+a*c])}else if(e.cY===f.cY){const r=e.cX-f.cX,c=Math.sign(r);for(let a=1;a<=Math.abs(r);a++)s.push(l(v)[f.cX+a*c][f.cY])}for(const r of s)st(r,f);_t()}function zt(e){var r,c,a,d,p,T,h,nt;const s=e.code;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s)){e.preventDefault();let X;switch(s){case"ArrowUp":X=(c=(r=l(v))==null?void 0:r[f.cX])==null?void 0:c[f.cY+1];break;case"ArrowDown":X=(d=(a=l(v))==null?void 0:a[f.cX])==null?void 0:d[f.cY-1];break;case"ArrowLeft":X=(T=(p=l(v))==null?void 0:p[f.cX+1])==null?void 0:T[f.cY];break;case"ArrowRight":X=(nt=(h=l(v))==null?void 0:h[f.cX-1])==null?void 0:nt[f.cY];break}X&&rt(X)}}function kt(e){let s;for(let r=0;r<e;r++){const c=[[-1,0],[1,0],[0,-1],[0,1]].map(a=>{var d,p;return(p=(d=l(v))==null?void 0:d[f.cX+a[0]])==null?void 0:p[f.cY+a[1]]}).filter(a=>a&&a.i!==(s==null?void 0:s.i));s=c[Math.floor(Math.random()*c.length)],st(f,s)}}async function ot(){m(G,!1);const e=O(...n().place.bbox.slice(0,2),0),s=O(...n().place.bbox.slice(2),0);let r=0,c=[s[0]-e[0],e[1]-s[1]];for(;r<x.maxZoom&&c[0]<u&&c[1]<u;)c=c.map(d=>d*2),r++;const a=u%2===1?Ht(...n().place.centroid,r):O(...n().place.centroid,r).map(d=>Math.round(d));if(m(v,wt(a)),kt(u*u*4),!l(K))try{(await fetch(x.url(...l(v)[0][0].xyz))).status===200?m(K,!0):m(N,!0)}catch{m(N,!0)}}Vt(ot),Dt();var R=ae(),V=_(R),Mt=k(_(V));et(Mt,"href",`${Zt??""}/`),g(V);var Z=k(V,2),j=_(Z),Xt=_(j,!0);g(j);var it=k(j,2),L=_(it),Yt=_(L);ht(Yt,{type:"shuffle",margin:!0}),Q(),g(L);var B=k(L,2),yt=_(B);ht(yt,{type:"share",margin:!0}),Q(),g(B);var $t=k(B,2);qt($t,{get message(){return`Try this ${n().place.name??""} map puzzle %23AnyMapPuzzle`},get url(){return b().url.href},get open(){return l(W)},set open(e){m(W,e)},$$legacy:!0}),g(it),g(Z);var ct=k(Z,2);{var Tt=e=>{var s=te();y(s,"margin-right",`-${J??""}px`),Kt(s,5,()=>l(v).flat().sort((r,c)=>r.i-c.i),r=>r.i,(r,c)=>{var a=Qt();y(a,"width",`calc(${100/u}% - ${J??""}px)`),y(a,"height",`calc(${100/u}% - ${J??""}px)`);var d=_(a);P(()=>et(d,"src",x.url(...l(c).xyz))),g(a),P(()=>{bt(a,"blank",l(c).blank&&!l(G)),bt(a,"fade-in",l(c).blank),y(a,"left",`${100*(l(c).cX/u)}%`),y(a,"top",`${100*(l(c).cY/u)}%`)}),C("click",a,()=>rt(l(c))),I(r,a)}),g(s),P(()=>y(s,"height",`${(l(D)||100)??""}px`)),gt(s,"clientWidth",r=>m(D,r)),C("focus",s,r=>r.target.scrollIntoView()),C("keydown",s,zt),I(e,s)},At=e=>{var s=St(),r=Ut(s);{var c=a=>{var d=ee(),p=_(d),T=k(p);Nt(T,()=>tt.filter(h=>h.id!==x.id).map(h=>`<a data-sveltekit-reload="" href="${b().url.href.replace(x.id,h.id)}">${h.label}</a>`).join(" or ")),Q(),g(d),P(()=>{et(d,"style",`height: ${(l(D)||100)??""}px; background: #ddd; padding: 12px;`),vt(p,`${x.label??""}
			map tiles not available for this area. Try using `)}),gt(d,"clientWidth",h=>m(D,h)),I(a,d)};pt(r,a=>{l(N)&&a(c)},!0)}I(e,s)};pt(ct,e=>{l(K)?e(Tt):e(At,!1)})}var It=k(ct,2);Ft(It,{get attribution(){return x.attribution}}),g(R),P(()=>vt(Xt,n().place.name)),C("click",L,ot),C("click",B,()=>m(W,!l(W))),I(i,R),Ot()}export{ve as component};
