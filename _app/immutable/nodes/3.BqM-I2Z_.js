var Nt=Object.defineProperty;var bt=n=>{throw TypeError(n)};var Ut=(n,a,i)=>a in n?Nt(n,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[a]=i;var gt=(n,a,i)=>Ut(n,typeof a!="symbol"?a+"":a,i),ot=(n,a,i)=>a.has(n)||bt("Cannot "+i);var $=(n,a,i)=>(ot(n,a,"read from private field"),i?i.call(n):a.get(n)),C=(n,a,i)=>a.has(n)?bt("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(n):a.set(n,i),rt=(n,a,i,c)=>(ot(n,a,"write to private field"),c?c.call(n,i):a.set(n,i),i),xt=(n,a,i)=>(ot(n,a,"access private method"),i);import{a as O,t as j,c as qt}from"../chunks/disclose-version.99O-hdS6.js";import{i as Ft}from"../chunks/legacy.DWlfCNZp.js";import{I as Jt,k as Kt,x as Rt,J as Vt,K as zt,L as jt,z as S,A as Et,q as t,M as b,B as x,D as w,C as g,N as it,y as Ht,O as k,P as _t}from"../chunks/runtime.D7Av2bsv.js";import{e as D,s as wt}from"../chunks/render.DAZ0GJAO.js";import{i as $t}from"../chunks/if.Daf_QZpO.js";import{s as Y,I as F,S as Qt,C as te,p as ee,a as A,e as ae,m as nt,t as J,h as se}from"../chunks/Credit.BFCy6D6M.js";import{s as oe,a as kt}from"../chunks/props.rWO465ez.js";import{a as re}from"../chunks/entry.CLVnAHwD.js";import{b as ct}from"../chunks/control.DXsSTagE.js";var y,Z,G,R,Xt;const V=class V{constructor(a){C(this,R);C(this,y,new WeakMap);C(this,Z);C(this,G);rt(this,G,a)}observe(a,i){var c=$(this,y).get(a)||new Set;return c.add(i),$(this,y).set(a,c),xt(this,R,Xt).call(this).observe(a,$(this,G)),()=>{var _=$(this,y).get(a);_.delete(i),_.size===0&&($(this,y).delete(a),$(this,Z).unobserve(a))}}};y=new WeakMap,Z=new WeakMap,G=new WeakMap,R=new WeakSet,Xt=function(){return $(this,Z)??rt(this,Z,new ResizeObserver(a=>{for(var i of a){V.entries.set(i.target,i);for(var c of $(this,y).get(i.target)||[])c(i)}}))},gt(V,"entries",new WeakMap);let lt=V;var ie=new lt({box:"border-box"});function yt(n,a,i){var c=ie.observe(n,()=>i(n[a]));Jt(()=>(Kt(()=>i(n[a])),c))}const ne=Math.PI/180;function ce(n,a,i){const c=K(n,a,i);return c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c}function K(n,a,i){const c=Math.sin(a*ne),_=Math.pow(2,i);let h=_*(n/360+.5);const v=_*(.5-.25*Math.log((1+c)/(1-c))/Math.PI);return h=h%_,h<0&&(h=h+_),[h,v,i]}var le=j('<button tabindex="-1" class="tile svelte-1iz63xd"><img class="tile-img svelte-1iz63xd" alt=""></button>'),fe=j('<div tabindex="0" class="grid svelte-1iz63xd"></div>'),de=j('<div class="grid svelte-1iz63xd"> <!> tiles.</div>'),ue=j('<main class="svelte-1iz63xd"><div class="flex-row svelte-1iz63xd"><nav class="flex-left svelte-1iz63xd">&lt; <a class="svelte-1iz63xd">Any Map Puzzle</a></nav> <div class="flex-right svelte-1iz63xd"><a class="icon-button zoom-button svelte-1iz63xd" title="Zoom in"><!></a> <a class="icon-button zoom-button svelte-1iz63xd" title="Zoom out"><!></a></div></div> <div class="flex-row svelte-1iz63xd"><h1 class="flex-left svelte-1iz63xd"> </h1> <div class="floating-icons flex-right svelte-1iz63xd"><button class="icon-button svelte-1iz63xd"><!>Shuffle</button> <button class="icon-button svelte-1iz63xd"><!>Share</button> <!></div></div>  <!> <!></main>');function $e(n,a){Rt(a,!1);const i=oe(),c=()=>kt(Yt,"$config",i),_=()=>kt(ee,"$page",i),h=k(),v=k(),Yt=Vt("config"),u=c().gridSize,E=7-u;let p=k(),d,X=k(),W=k(),L=k(!1),H=k(!1),B=k(!1),N=k(!1);function Mt(s){const r=Math.floor(u/2),o=[s[0]-r,s[1]-r,s[2]].map(e=>e<0?0:e),l=[];for(let e=0;e<u;e++){const f=[];for(let m=0;m<u;m++){const z={i:m*u+e,x:e,y:m,cX:e,cY:m,xyz:[o[0]+e,o[1]+m,o[2]],blank:!1};f.push(z)}l.push(f)}return d=l[u-1][u-1],d.blank=!0,l}async function Tt(){t(p).flat().every(s=>s.x===s.cX&&s.y===s.cY)&&(b(B,!0),await new Promise(s=>setTimeout(s,200)),await window.confetti({particleCount:500,spread:360,scalar:1.5}))}function ft(s,r){const o={cX:s.cX,cY:s.cY};s.cX=r.cX,s.cY=r.cY,r.cX=o.cX,r.cY=o.cY,_t(p,t(p)[s.cX][s.cY]=s),_t(p,t(p)[r.cX][r.cY]=r)}function dt(s){if(t(B))return;const r=[];if(s.cX===d.cX){const o=s.cY-d.cY,l=Math.sign(o);for(let e=1;e<=Math.abs(o);e++)r.push(t(p)[d.cX][d.cY+e*l])}else if(s.cY===d.cY){const o=s.cX-d.cX,l=Math.sign(o);for(let e=1;e<=Math.abs(o);e++)r.push(t(p)[d.cX+e*l][d.cY])}for(const o of r)ft(o,d);Tt()}function At(s){var o,l,e,f,m,I,z,ht;const r=s.code;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r)){s.preventDefault();let T;switch(r){case"ArrowUp":T=(l=(o=t(p))==null?void 0:o[d.cX])==null?void 0:l[d.cY+1];break;case"ArrowDown":T=(f=(e=t(p))==null?void 0:e[d.cX])==null?void 0:f[d.cY-1];break;case"ArrowLeft":T=(I=(m=t(p))==null?void 0:m[d.cX+1])==null?void 0:I[d.cY];break;case"ArrowRight":T=(ht=(z=t(p))==null?void 0:z[d.cX-1])==null?void 0:ht[d.cY];break}T&&dt(T)}}function Zt(s){let r;for(let o=0;o<s;o++){const l=[[-1,0],[1,0],[0,-1],[0,1]].map(e=>{var f,m;return(m=(f=t(p))==null?void 0:f[d.cX+e[0]])==null?void 0:m[d.cY+e[1]]}).filter(e=>e&&e.i!==(r==null?void 0:r.i));r=l[Math.floor(Math.random()*l.length)],ft(d,r)}}async function ut(){b(B,!1);const s=K(...c().place.bbox.slice(0,2),0),r=K(...c().place.bbox.slice(2),0);let o=0,l=[r[0]-s[0],s[1]-r[1]];for(;o<t(v).maxZoom&&l[0]<u&&l[1]<u;)l=l.map(f=>f*2),o++;t(h)&&(o=(()=>{let f=o+t(h);return f<2?2:f>t(v).maxZoom?t(v).maxZoom:f})()),b(X,o);const e=u%2===1?ce(...c().place.centroid,o):K(...c().place.centroid,o).map(f=>Math.round(f));if(b(p,Mt(e)),Zt(u*u*4),!t(L))try{(await fetch(t(v).url(...t(p)[0][0].xyz))).status===200?b(L,!0):b(H,!0)}catch{b(H,!0)}}re(()=>{b(L,!1),ut()}),zt(()=>c(),()=>{b(h,c().zoomOffset)}),zt(()=>c(),()=>{b(v,nt.find(s=>s.id===c().mapTiles)||nt[0])}),jt(),Ft();var Q=ue(),tt=x(Q),et=x(tt),Pt=w(x(et));Y(Pt,"href",`${ct??""}/`),g(et);var vt=w(et,2),M=x(vt),It=x(M);F(It,{type:"zoomin"}),g(M);var P=w(M,2),Ct=x(P);F(Ct,{type:"zoomout"}),g(P),g(vt),g(tt);var at=w(tt,2),st=x(at),Ot=x(st,!0);g(st);var pt=w(st,2),U=x(pt),St=x(U);F(St,{type:"shuffle",margin:!0}),it(),g(U);var q=w(U,2),Dt=x(q);F(Dt,{type:"share",margin:!0}),it(),g(q);var Gt=w(q,2);Qt(Gt,{get message(){return`Try this ${c().place.name??""} map puzzle %23AnyMapPuzzle`},get url(){return _().url.href},get open(){return t(N)},set open(s){b(N,s)},$$legacy:!0}),g(pt),g(at);var mt=w(at,2);{var Wt=s=>{var r=fe();A(r,"margin-right",`-${E??""}px`),ae(r,5,()=>t(p).flat().sort((o,l)=>o.i-l.i),o=>o.i,(o,l)=>{var e=le();A(e,"width",`calc(${100/u}% - ${E??""}px)`),A(e,"height",`calc(${100/u}% - ${E??""}px)`);var f=x(e);S(()=>Y(f,"src",t(v).url(...t(l).xyz))),g(e),S(()=>{J(e,"blank",t(l).blank&&!t(B)),J(e,"fade-in",t(l).blank),A(e,"left",`${100*(t(l).cX/u)}%`),A(e,"top",`${100*(t(l).cY/u)}%`)}),D("click",e,()=>dt(t(l))),O(o,e)}),g(r),S(()=>A(r,"height",`${(t(W)||100)??""}px`)),yt(r,"clientWidth",o=>b(W,o)),D("focus",r,o=>o.target.scrollIntoView()),D("keydown",r,At),O(s,r)},Lt=s=>{var r=qt(),o=Ht(r);{var l=e=>{var f=de(),m=x(f),I=w(m);se(I,()=>nt.filter(z=>z.id!==t(v).id).map(z=>`<a href="${_().url.href.replace(t(v).id,z.id)}">${z.label}</a>`).join(" or ")),it(),g(f),S(()=>{Y(f,"style",`height: ${(t(W)||100)??""}px; background: #ddd; padding: 12px;`),wt(m,`${t(v).label??""}
			map tiles not available for this area. Try zooming out or using `)}),yt(f,"clientWidth",z=>b(W,z)),O(e,f)};$t(o,e=>{t(H)&&e(l)},!0)}O(s,r)};$t(mt,s=>{t(L)?s(Wt):s(Lt,!1)})}var Bt=w(mt,2);te(Bt,{get attribution(){return t(v).attribution}}),g(Q),S(()=>{Y(M,"tabindex",t(X)>=t(v).maxZoom?"-1":null),Y(M,"href",`${ct??""}/${c().place.code??""}?maptiles=${t(v).id??""}&gridsize=${u??""}${(t(h)+1?`&zoom=${t(h)+1}`:"")??""}`),J(M,"disabled",t(X)>=t(v).maxZoom),Y(P,"tabindex",u<5&&t(X)<3||t(X)<4?"-1":null),Y(P,"href",`${ct??""}/${c().place.code??""}?maptiles=${t(v).id??""}&gridsize=${u??""}${(t(h)-1?`&zoom=${t(h)-1}`:"")??""}`),J(P,"disabled",u<5&&t(X)<3||t(X)<4),wt(Ot,c().place.name)}),D("click",U,ut),D("click",q,()=>b(N,!t(N))),O(n,Q),Et()}export{$e as component};
