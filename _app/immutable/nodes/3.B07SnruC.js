var Pe=Object.defineProperty;var ne=i=>{throw TypeError(i)};var Se=(i,e,o)=>e in i?Pe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var le=(i,e,o)=>Se(i,typeof e!="symbol"?e+"":e,o),R=(i,e,o)=>e.has(i)||ne("Cannot "+o);var y=(i,e,o)=>(R(i,e,"read from private field"),o?o.call(i):e.get(i)),$=(i,e,o)=>e.has(i)?ne("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,o),Z=(i,e,o,p)=>(R(i,e,"write to private field"),p?p.call(i,o):e.set(i,o),o),pe=(i,e,o)=>(R(i,e,"access private method"),o);import{a as A,t as j,c as Ie}from"../chunks/disclose-version.DjvNnsPL.js";import"../chunks/legacy.CXxP-W4o.js";import{m as Ge,b as We,p as De,o as Oe,t as T,j as Ve,g as n,n as w,k as x,s as _,l as g,q as H,i as Be,v as X,w as fe}from"../chunks/index-client.BvduMyYk.js";import{e as P,s as ue}from"../chunks/render.B8ji4My8.js";import{s as Le,p as Ue,i as de,a as je}from"../chunks/props.BVkKjN1A.js";import{m as J,I as he,S as qe,h as ve,e as Ce,s as S,p as Ee,a as K,t as be}from"../chunks/ShareButtons.CWi2vxaz.js";import{i as Fe}from"../chunks/lifecycle.gEcLSU_P.js";import{b as Re}from"../chunks/entry.CPwuRfzQ.js";var k,Y,I,L,ge;const U=class U{constructor(e){$(this,L);$(this,k,new WeakMap);$(this,Y);$(this,I);Z(this,I,e)}observe(e,o){var p=y(this,k).get(e)||new Set;return p.add(o),y(this,k).set(e,p),pe(this,L,ge).call(this).observe(e,y(this,I)),()=>{var d=y(this,k).get(e);d.delete(o),d.size===0&&(y(this,k).delete(e),y(this,Y).unobserve(e))}}};k=new WeakMap,Y=new WeakMap,I=new WeakMap,L=new WeakSet,ge=function(){return y(this,Y)??Z(this,Y,new ResizeObserver(e=>{for(var o of e){U.entries.set(o.target,o);for(var p of y(this,k).get(o.target)||[])p(o)}}))},le(U,"entries",new WeakMap);let N=U;var Ze=new N({box:"border-box"});function me(i,e,o){var p=Ze.observe(i,()=>o(i[e]));Ge(()=>(We(()=>o(i[e])),p))}const He=Math.PI/180;function Je(i,e,o){const p=B(i,e,o);return p[0]=Math.floor(p[0]),p[1]=Math.floor(p[1]),p}function B(i,e,o){const p=Math.sin(e*He),d=Math.pow(2,o);let v=d*(i/360+.5);const u=d*(.5-.25*Math.log((1+p)/(1-p))/Math.PI);return v=v%d,v<0&&(v=v+d),[v,u,o]}var Ke=j('<button tabindex="-1" class="tile svelte-sp0xey"><img class="tile-img svelte-sp0xey" alt=""></button>'),Ne=j('<div tabindex="0" class="grid svelte-sp0xey"></div>'),Qe=j('<div class="grid svelte-sp0xey"> <!>.</div>'),et=j(`<main class="svelte-sp0xey"><nav class="svelte-sp0xey">&lt; <a class="svelte-sp0xey">Any Map Puzzle</a></nav> <div class="title-block svelte-sp0xey"><h1 class="title svelte-sp0xey"> </h1> <div class="floating-icons svelte-sp0xey"><button class="icon-button svelte-sp0xey"><!>Shuffle</button> <button class="icon-button svelte-sp0xey"><!>Share</button> <!></div></div>  <!> <p class="credit svelte-sp0xey">Any Map Puzzle was designed and coded by <a target="_blank" href="https://bsky.app/profile/bothness.bsky.social" class="svelte-sp0xey">Ahmad Barclay</a>, inspired by Eugene Alvin Villar's <a target="_blank" href="https://seav.github.io/osm-15-puzzle/" class="svelte-sp0xey">OSM 15 Puzzle</a>. View the <a target="_blank" href="https://github.com/bothness/anymap/" class="svelte-sp0xey">source code</a> on Github. <!></p></main>`);function pt(i,e){De(e,!1);const o=Le(),p=()=>je(Ee,"$page",o);let d=Ue(e,"data",8);const v=J.find(t=>t.id===d().mapTiles)||J[0],u=d().gridSize;let b=X(),l,G=X(),Q=X(!1),ee=X(!1),W=X(!1),D=X(!1);function xe(t){const a=Math.floor(u/2),r=[t[0]-a,t[1]-a,t[2]],c=[];for(let s=0;s<u;s++){const h=[];for(let f=0;f<u;f++){const m={i:f*u+s,x:s,y:f,cX:s,cY:f,xyz:[r[0]+s,r[1]+f,r[2]],blank:!1};h.push(m)}c.push(h)}return l=c[u-1][u-1],l.blank=!0,c}async function ye(){n(b).flat().every(t=>t.x===t.cX&&t.y===t.cY)&&(w(W,!0),await new Promise(t=>setTimeout(t,200)),await window.confetti({particleCount:500,spread:360,scalar:1.5}))}function te(t,a){const r={cX:t.cX,cY:t.cY};t.cX=a.cX,t.cY=a.cY,a.cX=r.cX,a.cY=r.cY,fe(b,n(b)[t.cX][t.cY]=t),fe(b,n(b)[a.cX][a.cY]=a)}function se(t){if(n(W))return;const a=[];if(t.cX===l.cX){const r=t.cY-l.cY,c=Math.sign(r);for(let s=1;s<=Math.abs(r);s++)a.push(n(b)[l.cX][l.cY+s*c])}else if(t.cY===l.cY){const r=t.cX-l.cX,c=Math.sign(r);for(let s=1;s<=Math.abs(r);s++)a.push(n(b)[l.cX+s*c][l.cY])}for(const r of a)te(r,l);ye()}function we(t){var r,c,s,h,f,z,m,ce;const a=t.code;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(a)){t.preventDefault();let M;switch(a){case"ArrowUp":M=(c=(r=n(b))==null?void 0:r[l.cX])==null?void 0:c[l.cY+1];break;case"ArrowDown":M=(h=(s=n(b))==null?void 0:s[l.cX])==null?void 0:h[l.cY-1];break;case"ArrowLeft":M=(z=(f=n(b))==null?void 0:f[l.cX+1])==null?void 0:z[l.cY];break;case"ArrowRight":M=(ce=(m=n(b))==null?void 0:m[l.cX-1])==null?void 0:ce[l.cY];break}M&&se(M)}}function _e(t){let a;for(let r=0;r<t;r++){const c=[[-1,0],[1,0],[0,-1],[0,1]].map(s=>{var h,f;return(f=(h=n(b))==null?void 0:h[l.cX+s[0]])==null?void 0:f[l.cY+s[1]]}).filter(s=>s&&s.i!==(a==null?void 0:a.i));a=c[Math.floor(Math.random()*c.length)],te(l,a)}}async function ae(){w(W,!1);const t=B(...d().place.bbox.slice(0,2),0),a=B(...d().place.bbox.slice(2),0);let r=0,c=[a[0]-t[0],t[1]-a[1]];for(;r<v.maxZoom&&c[0]<u&&c[1]<u;)c=c.map(f=>f*2),r++;const s=u%2===1?Je(...d().place.centroid,r):B(...d().place.centroid,r).map(f=>Math.round(f));w(b,xe(s)),(await fetch(v.url(...n(b)[0][0].xyz))).status===200?(_e(u*u*4),w(Q,!0)):w(ee,!0)}Oe(ae),Fe();var q=et(),C=x(q),ke=_(x(C));g(C);var E=_(C,2),F=x(E),Me=x(F,!0);g(F);var re=_(F,2),O=x(re),Xe=x(O);he(Xe,{type:"shuffle",margin:!0}),H(),g(O);var V=_(O,2),Ye=x(V);he(Ye,{type:"share",margin:!0}),H(),g(V);var ze=_(V,2);qe(ze,{get message(){return`Try this ${d().place.name??""} map puzzle %23AnyMapPuzzle`},get url(){return p().url.href},get open(){return n(D)},set open(t){w(D,t)},$$legacy:!0}),g(re),g(E);var oe=_(E,2);{var $e=t=>{var a=Ne();Ce(a,5,()=>n(b).flat().sort((r,c)=>r.i-c.i),r=>r.i,(r,c)=>{var s=Ke();S(s,"width",`calc(${100/u}% - 4px)`),S(s,"height",`calc(${100/u}% - 4px)`);var h=x(s);T(()=>K(h,"src",v.url(...n(c).xyz))),g(s),T(()=>{be(s,"blank",n(c).blank&&!n(W)),be(s,"fade-in",n(c).blank),S(s,"left",`${100*(n(c).cX/u)}%`),S(s,"top",`${100*(n(c).cY/u)}%`)}),P("click",s,()=>se(n(c))),A(r,s)}),g(a),T(()=>S(a,"height",`${(n(G)||100)??""}px`)),me(a,"clientWidth",r=>w(G,r)),P("focus",a,r=>r.target.scrollIntoView()),P("keydown",a,we),A(t,a)},Ae=t=>{var a=Ie(),r=Be(a);{var c=s=>{var h=Qe(),f=x(h),z=_(f);ve(z,()=>J.filter(m=>m.id!==v.id).map(m=>`<a data-sveltekit-reload="" href="${p().url.href.replace(v.id,m.id)}">${m.label}</a>`).join(" or ")),H(),g(h),T(()=>{K(h,"style",`height: ${(n(G)||100)??""}px; background: #ddd; padding: 12px;`),ue(f,`${v.label??""}
			map tiles not available for this area. Try using `)}),me(h,"clientWidth",m=>w(G,m)),A(s,h)};de(r,s=>{n(ee)&&s(c)},!0)}A(t,a)};de(oe,t=>{n(Q)?t($e):t(Ae,!1)})}var ie=_(oe,2),Te=_(x(ie),7);ve(Te,()=>v.attribution),g(ie),g(q),T(()=>{K(ke,"href",`${Re??""}/?place=${d().place.code??""}&maptiles=${v.id??""}&gridsize=${u??""}`),ue(Me,d().place.name)}),P("click",O,ae),P("click",V,()=>w(D,!n(D))),A(i,q),Ve()}export{pt as component};
